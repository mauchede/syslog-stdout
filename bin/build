#!/bin/bash
set -e
cd "`dirname "$0"`/.."

[[ -z $DIST_FOLDER ]] && DIST_FOLDER="$(pwd)/dist"
[[ -z $SRC_FOLDER ]] && SRC_FOLDER="$(pwd)/src"

go() {
    docker run \
        --rm \
        -v /etc/group:/etc/group:ro \
        -v /etc/passwd:/etc/passwd:ro \
        -v /etc/localtime:/etc/localtime:ro \
        -v "$DIST_FOLDER:/go/bin" \
        -v "$SRC_FOLDER:/go/src/github.com/mauchede/syslog-stdout" \
        -u $USER \
        -w "$PWD" \
        -ti golang:1.3 go "$@"
}

rm $DIST_FOLDER/syslog-stdout 2> /dev/null || :
go install github.com/mauchede/syslog-stdout
